<!-- IT-ERA Universal Contact Form Component -->
<style>
.it-era-contact-form {
  max-width: 600px;
  margin: 40px auto;
  padding: 30px;
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 86, 204, 0.1);
  border: 1px solid #e1e8f0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.it-era-contact-form h2 {
  color: #0056cc;
  text-align: center;
  margin-bottom: 8px;
  font-size: 28px;
  font-weight: 700;
}

.it-era-contact-form .form-subtitle {
  text-align: center;
  color: #6c757d;
  margin-bottom: 30px;
  font-size: 16px;
}

.it-era-form-group {
  margin-bottom: 20px;
}

.it-era-form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #2c3e50;
  font-size: 14px;
}

.it-era-form-group .required {
  color: #dc3545;
}

.it-era-form-group input,
.it-era-form-group select,
.it-era-form-group textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e1e8f0;
  border-radius: 8px;
  font-size: 16px;
  transition: all 0.3s ease;
  font-family: inherit;
  background: #ffffff;
}

.it-era-form-group input:focus,
.it-era-form-group select:focus,
.it-era-form-group textarea:focus {
  outline: none;
  border-color: #0056cc;
  box-shadow: 0 0 0 3px rgba(0, 86, 204, 0.1);
}

.it-era-form-group textarea {
  min-height: 120px;
  resize: vertical;
}

.it-era-form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.it-era-gdpr-notice {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 8px;
  margin: 20px 0;
  font-size: 13px;
  color: #6c757d;
  border-left: 4px solid #0056cc;
}

.it-era-submit-btn {
  background: linear-gradient(135deg, #0056cc, #0041a3);
  color: white;
  padding: 15px 40px;
  border: none;
  border-radius: 8px;
  font-size: 18px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
  position: relative;
  overflow: hidden;
}

.it-era-submit-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 86, 204, 0.3);
}

.it-era-submit-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.it-era-loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid #ffffff;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 1s ease-in-out infinite;
  margin-right: 10px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.it-era-message {
  padding: 15px;
  border-radius: 8px;
  margin: 20px 0;
  font-weight: 500;
}

.it-era-success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.it-era-error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.it-era-contact-info {
  background: linear-gradient(135deg, #0056cc, #0041a3);
  color: white;
  padding: 20px;
  border-radius: 8px;
  margin-top: 30px;
  text-align: center;
}

.it-era-contact-info h3 {
  margin: 0 0 15px 0;
  font-size: 20px;
}

.it-era-contact-info p {
  margin: 5px 0;
  opacity: 0.9;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .it-era-contact-form {
    margin: 20px;
    padding: 20px;
  }
  
  .it-era-form-row {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  
  .it-era-contact-form h2 {
    font-size: 24px;
  }
}

/* Service-specific color themes */
.service-sicurezza .it-era-contact-form h2,
.service-sicurezza .it-era-form-group label,
.service-sicurezza .it-era-gdpr-notice {
  border-left-color: #dc3545;
}

.service-sicurezza .it-era-form-group input:focus,
.service-sicurezza .it-era-form-group select:focus,
.service-sicurezza .it-era-form-group textarea:focus {
  border-color: #dc3545;
  box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
}

.service-sicurezza .it-era-submit-btn {
  background: linear-gradient(135deg, #dc3545, #a71e2a);
}

.service-sicurezza .it-era-contact-info {
  background: linear-gradient(135deg, #dc3545, #a71e2a);
}

.service-cloud .it-era-contact-form h2,
.service-cloud .it-era-form-group label,
.service-cloud .it-era-gdpr-notice {
  border-left-color: #17a2b8;
}

.service-cloud .it-era-form-group input:focus,
.service-cloud .it-era-form-group select:focus,
.service-cloud .it-era-form-group textarea:focus {
  border-color: #17a2b8;
  box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.1);
}

.service-cloud .it-era-submit-btn {
  background: linear-gradient(135deg, #17a2b8, #117a8b);
}

.service-cloud .it-era-contact-info {
  background: linear-gradient(135deg, #17a2b8, #117a8b);
}
</style>

<div class="it-era-contact-form" id="itEraContactForm">
  <h2>Richiedi Informazioni</h2>
  <p class="form-subtitle">Il nostro team ti risponder√† entro 2 ore durante l'orario lavorativo</p>
  
  <form id="contactForm" novalidate>
    <div class="it-era-form-row">
      <div class="it-era-form-group">
        <label for="nome">Nome e Cognome <span class="required">*</span></label>
        <input type="text" id="nome" name="nome" required>
      </div>
      
      <div class="it-era-form-group">
        <label for="email">Email <span class="required">*</span></label>
        <input type="email" id="email" name="email" required>
      </div>
    </div>
    
    <div class="it-era-form-row">
      <div class="it-era-form-group">
        <label for="telefono">Telefono</label>
        <input type="tel" id="telefono" name="telefono">
      </div>
      
      <div class="it-era-form-group">
        <label for="azienda">Azienda</label>
        <input type="text" id="azienda" name="azienda">
      </div>
    </div>
    
    <div class="it-era-form-group">
      <label for="servizio">Servizio di interesse</label>
      <select id="servizio" name="servizio">
        <option value="">Seleziona un servizio...</option>
        <option value="assistenza-it">Assistenza IT</option>
        <option value="sicurezza-informatica">Sicurezza Informatica</option>
        <option value="cloud-storage">Cloud Storage</option>
        <option value="consulenza-generale">Consulenza Generale</option>
        <option value="altro">Altro</option>
      </select>
    </div>
    
    <div class="it-era-form-group">
      <label for="messaggio">Messaggio <span class="required">*</span></label>
      <textarea id="messaggio" name="messaggio" placeholder="Descrivi la tua richiesta..." required></textarea>
    </div>
    
    <div class="it-era-gdpr-notice">
      <p><strong>Privacy:</strong> I tuoi dati sono trattati secondo il GDPR. 
      Utilizzando questo modulo accetti il trattamento dei dati per rispondere alla tua richiesta. 
      <a href="/privacy-policy" target="_blank">Leggi l'informativa privacy</a></p>
    </div>
    
    <button type="submit" class="it-era-submit-btn" id="submitBtn">
      <span id="submitText">Invia Richiesta</span>
    </button>
  </form>
  
  <div id="responseMessage"></div>
  
  <div class="it-era-contact-info">
    <h3>Contatti Diretti</h3>
    <p><strong>üìû Telefono:</strong> 039 888 2041</p>
    <p><strong>üìß Email:</strong> info@it-era.it</p>
    <p><strong>üìç Indirizzo:</strong> Viale Risorgimento 32, Vimercate MB</p>
  </div>
</div>

<script>
// IT-ERA Contact Form Handler
(function() {
  'use strict';
  
  const form = document.getElementById('contactForm');
  const submitBtn = document.getElementById('submitBtn');
  const submitText = document.getElementById('submitText');
  const responseMessage = document.getElementById('responseMessage');
  
  // Auto-detect service type from URL
  function detectServiceType() {
    const url = window.location.href.toLowerCase();
    if (url.includes('sicurezza-informatica')) return 'sicurezza-informatica';
    if (url.includes('cloud-storage')) return 'cloud-storage';
    if (url.includes('assistenza-it')) return 'assistenza-it';
    return 'generale';
  }
  
  // Apply service-specific styling
  function applyServiceStyling() {
    const serviceType = detectServiceType();
    const formContainer = document.getElementById('itEraContactForm');
    
    if (serviceType === 'sicurezza-informatica') {
      document.body.classList.add('service-sicurezza');
    } else if (serviceType === 'cloud-storage') {
      document.body.classList.add('service-cloud');
    }
    
    // Pre-select service in dropdown
    const serviceSelect = document.getElementById('servizio');
    if (serviceSelect && serviceType !== 'generale') {
      serviceSelect.value = serviceType;
    }
  }
  
  // Form validation
  function validateForm(formData) {
    const errors = [];
    
    if (!formData.nome.trim()) {
      errors.push('Nome e cognome √® obbligatorio');
    }
    
    if (!formData.email.trim()) {
      errors.push('Email √® obbligatoria');
    } else if (!isValidEmail(formData.email)) {
      errors.push('Inserisci un\'email valida');
    }
    
    if (!formData.messaggio.trim()) {
      errors.push('Il messaggio √® obbligatorio');
    } else if (formData.messaggio.trim().length < 10) {
      errors.push('Il messaggio deve essere di almeno 10 caratteri');
    }
    
    return errors;
  }
  
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }
  
  // Show message to user
  function showMessage(message, type) {
    responseMessage.innerHTML = `<div class="it-era-message it-era-${type}">${message}</div>`;
    responseMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
  
  // Submit form
  async function submitForm(formData) {
    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          ...formData,
          pageUrl: window.location.href,
          userAgent: navigator.userAgent,
          timestamp: new Date().toISOString()
        })
      });
      
      const result = await response.json();
      
      if (result.success) {
        showMessage(
          `‚úÖ <strong>Richiesta inviata con successo!</strong><br>
          Ticket ID: <strong>${result.ticketId}</strong><br>
          Riceverai una conferma via email entro pochi minuti.`, 
          'success'
        );
        form.reset();
        
        // Optional: Track conversion
        if (typeof gtag !== 'undefined') {
          gtag('event', 'form_submit', {
            'event_category': 'Contact',
            'event_label': detectServiceType(),
            'value': 1
          });
        }
        
      } else {
        showMessage(`‚ùå <strong>Errore:</strong> ${result.error}`, 'error');
      }
      
    } catch (error) {
      console.error('Form submission error:', error);
      showMessage(
        '‚ùå <strong>Errore di connessione.</strong><br>Riprova tra qualche minuto o chiamaci al 039 888 2041', 
        'error'
      );
    }
  }
  
  // Form submit handler
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Get form data
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    // Validate form
    const errors = validateForm(data);
    if (errors.length > 0) {
      showMessage(`‚ùå <strong>Errori di validazione:</strong><br>‚Ä¢ ${errors.join('<br>‚Ä¢ ')}`, 'error');
      return;
    }
    
    // Show loading state
    submitBtn.disabled = true;
    submitText.innerHTML = '<span class="it-era-loading"></span>Invio in corso...';
    responseMessage.innerHTML = '';
    
    try {
      await submitForm(data);
    } finally {
      // Reset button state
      submitBtn.disabled = false;
      submitText.innerHTML = 'Invia Richiesta';
    }
  });
  
  // Initialize form
  document.addEventListener('DOMContentLoaded', function() {
    applyServiceStyling();
  });
  
  // Apply styling immediately if DOM is already loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', applyServiceStyling);
  } else {
    applyServiceStyling();
  }
  
})();
</script>