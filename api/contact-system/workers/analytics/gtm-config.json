{
  "containerName": "IT-ERA Analytics Container",
  "description": "Google Tag Manager configuration for IT-ERA website tracking with GA4",
  "version": "1.0.0",
  "tags": [
    {
      "name": "GA4 Configuration Tag",
      "type": "gaawe",
      "firingTriggers": ["Initialization - All Pages"],
      "parameter": [
        {
          "key": "measurementId",
          "value": "{{GA4 Measurement ID}}"
        },
        {
          "key": "enhancedMeasurement",
          "value": true
        },
        {
          "key": "allowGoogleSignals",
          "value": false
        },
        {
          "key": "allowAdPersonalizationSignals",
          "value": false
        },
        {
          "key": "cookieFlags",
          "value": "SameSite=Strict;Secure"
        }
      ]
    },
    {
      "name": "GA4 Event - Form Submission",
      "type": "gaawe",
      "firingTriggers": ["Contact Form Submission"],
      "parameter": [
        {
          "key": "measurementId",
          "value": "{{GA4 Measurement ID}}"
        },
        {
          "key": "eventName",
          "value": "generate_lead"
        },
        {
          "key": "eventParameters",
          "value": {
            "currency": "EUR",
            "value": "{{Service Value}}",
            "lead_type": "contact_form",
            "service_type": "{{Service Type}}",
            "city": "{{City}}",
            "form_id": "{{Form ID}}",
            "urgency": "{{Form Urgency}}"
          }
        }
      ]
    },
    {
      "name": "GA4 Event - Phone Click",
      "type": "gaawe",
      "firingTriggers": ["Phone Click"],
      "parameter": [
        {
          "key": "measurementId",
          "value": "{{GA4 Measurement ID}}"
        },
        {
          "key": "eventName",
          "value": "phone_click"
        },
        {
          "key": "eventParameters",
          "value": {
            "phone_number": "{{Phone Number}}",
            "service_type": "{{Service Type}}",
            "city": "{{City}}"
          }
        }
      ]
    },
    {
      "name": "GA4 Event - Email Click",
      "type": "gaawe",
      "firingTriggers": ["Email Click"],
      "parameter": [
        {
          "key": "measurementId",
          "value": "{{GA4 Measurement ID}}"
        },
        {
          "key": "eventName",
          "value": "email_click"
        },
        {
          "key": "eventParameters",
          "value": {
            "email_address": "{{Email Address}}",
            "service_type": "{{Service Type}}",
            "city": "{{City}}"
          }
        }
      ]
    },
    {
      "name": "GA4 Event - Chatbot Interaction",
      "type": "gaawe",
      "firingTriggers": ["Chatbot Open", "Chatbot Message"],
      "parameter": [
        {
          "key": "measurementId",
          "value": "{{GA4 Measurement ID}}"
        },
        {
          "key": "eventName",
          "value": "{{Chatbot Event Name}}"
        },
        {
          "key": "eventParameters",
          "value": {
            "service_type": "{{Service Type}}",
            "city": "{{City}}",
            "interaction_type": "{{Chatbot Interaction Type}}"
          }
        }
      ]
    },
    {
      "name": "GA4 Enhanced Ecommerce - Service View",
      "type": "gaawe",
      "firingTriggers": ["Service Page View"],
      "parameter": [
        {
          "key": "measurementId",
          "value": "{{GA4 Measurement ID}}"
        },
        {
          "key": "eventName",
          "value": "view_item"
        },
        {
          "key": "eventParameters",
          "value": {
            "currency": "EUR",
            "value": "{{Service Value}}",
            "items": [
              {
                "item_id": "{{Service Type}}-{{City}}",
                "item_name": "{{Service Category}} - {{City}}",
                "item_category": "{{Service Category}}",
                "price": "{{Service Value}}",
                "quantity": 1
              }
            ]
          }
        }
      ]
    },
    {
      "name": "GA4 Conversion - Lead Generated",
      "type": "gaawe",
      "firingTriggers": ["Form Submission", "Phone Click Conversion"],
      "parameter": [
        {
          "key": "measurementId",
          "value": "{{GA4 Measurement ID}}"
        },
        {
          "key": "eventName",
          "value": "purchase"
        },
        {
          "key": "eventParameters",
          "value": {
            "transaction_id": "{{Lead ID}}",
            "currency": "EUR",
            "value": "{{Service Value}}",
            "items": [
              {
                "item_id": "{{Service Type}}-{{City}}",
                "item_name": "{{Service Category}} Lead - {{City}}",
                "item_category": "{{Service Category}}",
                "price": "{{Service Value}}",
                "quantity": 1
              }
            ]
          }
        }
      ]
    }
  ],
  "triggers": [
    {
      "name": "Initialization - All Pages",
      "type": "PAGEVIEW"
    },
    {
      "name": "Contact Form Submission",
      "type": "FORM_SUBMIT",
      "filter": [
        {
          "type": "FORM_ID",
          "parameter": [
            {
              "key": "operator",
              "value": "CONTAINS"
            },
            {
              "key": "value",
              "value": "contact"
            }
          ]
        }
      ]
    },
    {
      "name": "Phone Click",
      "type": "LINK_CLICK",
      "filter": [
        {
          "type": "CLICK_URL",
          "parameter": [
            {
              "key": "operator",
              "value": "STARTS_WITH"
            },
            {
              "key": "value",
              "value": "tel:"
            }
          ]
        }
      ]
    },
    {
      "name": "Email Click",
      "type": "LINK_CLICK",
      "filter": [
        {
          "type": "CLICK_URL",
          "parameter": [
            {
              "key": "operator",
              "value": "STARTS_WITH"
            },
            {
              "key": "value",
              "value": "mailto:"
            }
          ]
        }
      ]
    },
    {
      "name": "Service Page View",
      "type": "PAGEVIEW",
      "filter": [
        {
          "type": "PAGE_PATH",
          "parameter": [
            {
              "key": "operator",
              "value": "MATCHES_REGEX"
            },
            {
              "key": "value",
              "value": "/(assistenza-it|sicurezza-informatica|cloud-storage)-.*\\.html"
            }
          ]
        }
      ]
    },
    {
      "name": "Chatbot Open",
      "type": "CUSTOM_EVENT",
      "customEventFilter": [
        {
          "type": "EVENT_NAME",
          "parameter": [
            {
              "key": "operator",
              "value": "EQUALS"
            },
            {
              "key": "value",
              "value": "chatbot_opened"
            }
          ]
        }
      ]
    },
    {
      "name": "Chatbot Message",
      "type": "CUSTOM_EVENT",
      "customEventFilter": [
        {
          "type": "EVENT_NAME",
          "parameter": [
            {
              "key": "operator",
              "value": "EQUALS"
            },
            {
              "key": "value",
              "value": "chatbot_message_sent"
            }
          ]
        }
      ]
    },
    {
      "name": "Phone Click Conversion",
      "type": "CUSTOM_EVENT",
      "customEventFilter": [
        {
          "type": "EVENT_NAME",
          "parameter": [
            {
              "key": "operator",
              "value": "EQUALS"
            },
            {
              "key": "value",
              "value": "phone_conversion"
            }
          ]
        }
      ]
    }
  ],
  "variables": [
    {
      "name": "GA4 Measurement ID",
      "type": "c",
      "parameter": [
        {
          "key": "value",
          "value": "G-XXXXXXXXX"
        }
      ]
    },
    {
      "name": "Service Type",
      "type": "jsm",
      "parameter": [
        {
          "key": "javascript",
          "value": "function() {\n  var path = {{Page Path}};\n  if (path.indexOf('assistenza-it') > -1) return 'assistenza-it';\n  if (path.indexOf('sicurezza-informatica') > -1) return 'sicurezza-informatica';\n  if (path.indexOf('cloud-storage') > -1) return 'cloud-storage';\n  return 'general';\n}"
        }
      ]
    },
    {
      "name": "City",
      "type": "jsm",
      "parameter": [
        {
          "key": "javascript",
          "value": "function() {\n  var path = {{Page Path}};\n  var match = path.match(/-(\\w[\\w-]*)\\.html$/);\n  if (match) {\n    return match[1].replace(/-/g, ' ').replace(/\\b\\w/g, function(l) {\n      return l.toUpperCase();\n    });\n  }\n  return 'Unknown';\n}"
        }
      ]
    },
    {
      "name": "Service Value",
      "type": "jsm",
      "parameter": [
        {
          "key": "javascript",
          "value": "function() {\n  var serviceType = {{Service Type}};\n  var values = {\n    'assistenza-it': 290,\n    'sicurezza-informatica': 899,\n    'cloud-storage': 50\n  };\n  return values[serviceType] || 100;\n}"
        }
      ]
    },
    {
      "name": "Service Category",
      "type": "jsm",
      "parameter": [
        {
          "key": "javascript",
          "value": "function() {\n  var serviceType = {{Service Type}};\n  var categories = {\n    'assistenza-it': 'IT Support',\n    'sicurezza-informatica': 'Cybersecurity',\n    'cloud-storage': 'Cloud Services'\n  };\n  return categories[serviceType] || 'General';\n}"
        }
      ]
    },
    {
      "name": "Phone Number",
      "type": "aev",
      "parameter": [
        {
          "key": "varType",
          "value": "HREF"
        },
        {
          "key": "stripWww",
          "value": false
        }
      ]
    },
    {
      "name": "Email Address",
      "type": "aev",
      "parameter": [
        {
          "key": "varType",
          "value": "HREF"
        }
      ]
    },
    {
      "name": "Form ID",
      "type": "aev",
      "parameter": [
        {
          "key": "varType",
          "value": "ID"
        }
      ]
    },
    {
      "name": "Form Urgency",
      "type": "jsm",
      "parameter": [
        {
          "key": "javascript",
          "value": "function() {\n  var form = {{Form Element}};\n  if (form) {\n    var urgencySelect = form.querySelector('select[name=\"urgenza\"]');\n    if (urgencySelect) {\n      return urgencySelect.value;\n    }\n  }\n  return 'normale';\n}"
        }
      ]
    },
    {
      "name": "Lead ID",
      "type": "jsm",
      "parameter": [
        {
          "key": "javascript",
          "value": "function() {\n  return 'lead-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);\n}"
        }
      ]
    },
    {
      "name": "Chatbot Event Name",
      "type": "v",
      "parameter": [
        {
          "key": "name",
          "value": "gtm.eventName"
        }
      ]
    },
    {
      "name": "Chatbot Interaction Type",
      "type": "v",
      "parameter": [
        {
          "key": "name",
          "value": "interaction_type"
        }
      ]
    }
  ],
  "builtInVariables": [
    "PAGE_PATH",
    "PAGE_TITLE",
    "PAGE_URL",
    "REFERRER",
    "EVENT",
    "CLICK_ELEMENT",
    "CLICK_URL",
    "FORM_ELEMENT"
  ],
  "fingerprint": "IT-ERA-GTM-v1.0.0",
  "tagManagerUrl": "https://tagmanager.google.com/",
  "notes": "GTM configuration for IT-ERA website with comprehensive GA4 event tracking, GDPR compliance, and enhanced ecommerce for service lead generation."
}