<!-- Universal Contact Form Component for IT-ERA -->
<!-- To use: Include this component and add data-service attribute for specific services -->

<style>
/* Contact Form Styles - Optimized for Conversion */
.contact-form-container {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    margin: 40px 0;
    position: relative;
    overflow: hidden;
}

.contact-form-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, #0056cc, #00b336);
}

.contact-form-container h2 {
    color: #0056cc;
    font-weight: 700;
    margin-bottom: 10px;
    font-size: 2rem;
}

.contact-form-container .subtitle {
    color: #6c757d;
    font-size: 1.1rem;
    margin-bottom: 30px;
}

.form-floating label {
    color: #6c757d;
    font-weight: 500;
}

.form-control:focus {
    border-color: #0056cc;
    box-shadow: 0 0 0 0.25rem rgba(0, 86, 204, 0.15);
}

.form-select:focus {
    border-color: #0056cc;
    box-shadow: 0 0 0 0.25rem rgba(0, 86, 204, 0.15);
}

.btn-contact-submit {
    background: linear-gradient(135deg, #0056cc 0%, #00b336 100%);
    border: none;
    padding: 15px 40px;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 50px;
    color: white;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.btn-contact-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 86, 204, 0.3);
}

.btn-contact-submit:disabled {
    opacity: 0.6;
    transform: none !important;
    box-shadow: none !important;
}

.btn-contact-submit .spinner-border {
    width: 1.2rem;
    height: 1.2rem;
    border-width: 0.2em;
    margin-right: 10px;
}

.form-feedback {
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    border-left: 5px solid;
    font-weight: 500;
}

.form-feedback.alert-success {
    background-color: #d1e7dd;
    color: #0f5132;
    border-left-color: #00b336;
}

.form-feedback.alert-danger {
    background-color: #f8d7da;
    color: #842029;
    border-left-color: #dc3545;
}

.form-feedback .feedback-icon {
    font-size: 1.5rem;
    margin-right: 10px;
}

.privacy-check {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    border: 1px solid #e9ecef;
    margin: 20px 0;
}

.privacy-check .form-check-input:checked {
    background-color: #0056cc;
    border-color: #0056cc;
}

.emergency-notice {
    background: linear-gradient(135deg, #dc3545, #c82333);
    color: white;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    margin-bottom: 30px;
    animation: pulse-emergency 2s infinite;
}

@keyframes pulse-emergency {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

.emergency-notice a {
    color: white;
    font-weight: bold;
    text-decoration: none;
    background: rgba(255, 255, 255, 0.2);
    padding: 10px 20px;
    border-radius: 25px;
    display: inline-block;
    margin-top: 10px;
    transition: all 0.3s;
}

.emergency-notice a:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.05);
}

.invalid-feedback {
    display: block !important;
    color: #dc3545;
    font-size: 0.875em;
    margin-top: 0.25rem;
    animation: shake 0.5s ease-in-out;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

.is-invalid {
    border-color: #dc3545 !important;
    animation: shake 0.5s ease-in-out;
}

.contact-benefits {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.benefit-item {
    text-align: center;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.benefit-item i {
    font-size: 2rem;
    color: #0056cc;
    margin-bottom: 10px;
}

.benefit-item h6 {
    font-weight: 600;
    margin-bottom: 5px;
}

.benefit-item small {
    color: #6c757d;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .contact-form-container {
        padding: 25px;
        margin: 20px 0;
    }
    
    .contact-form-container h2 {
        font-size: 1.5rem;
    }
    
    .btn-contact-submit {
        padding: 12px 30px;
        font-size: 1rem;
    }
}
</style>

<!-- Contact Form HTML -->
<div class="contact-form-container" id="contactFormContainer">
    <!-- Emergency Notice -->
    <div class="emergency-notice">
        <i class="fas fa-exclamation-triangle"></i>
        <strong>Hai un'emergenza informatica?</strong><br>
        <small>Supporto immediato 24/7 per situazioni critiche</small>
        <a href="tel:+390398882041" onclick="trackEmergencyClick()">
            üìû 039 888 2041
        </a>
    </div>

    <!-- Form Header -->
    <div class="text-center mb-4">
        <h2>Richiedi Preventivo Gratuito</h2>
        <p class="subtitle">Ricevi una consulenza personalizzata e scopri come possiamo aiutarti</p>
    </div>

    <!-- Benefits Grid -->
    <div class="contact-benefits">
        <div class="benefit-item">
            <i class="fas fa-clock"></i>
            <h6>Risposta in 4h</h6>
            <small>Garantita in orario lavorativo</small>
        </div>
        <div class="benefit-item">
            <i class="fas fa-shield-alt"></i>
            <h6>Preventivo Gratuito</h6>
            <small>Nessun costo nascosto</small>
        </div>
        <div class="benefit-item">
            <i class="fas fa-users"></i>
            <h6>Team Certificato</h6>
            <small>Tecnici specializzati</small>
        </div>
    </div>

    <!-- Contact Form -->
    <form class="contact-form" id="universalContactForm" data-form-type="preventivo">
        <div class="row g-3">
            <!-- Nome e Cognome -->
            <div class="col-md-6">
                <div class="form-floating">
                    <input type="text" class="form-control" id="nome" name="nome" placeholder="Nome e Cognome" required>
                    <label for="nome"><i class="fas fa-user me-2"></i>Nome e Cognome *</label>
                </div>
            </div>

            <!-- Email -->
            <div class="col-md-6">
                <div class="form-floating">
                    <input type="email" class="form-control" id="email" name="email" placeholder="Email" required>
                    <label for="email"><i class="fas fa-envelope me-2"></i>Email *</label>
                </div>
            </div>

            <!-- Telefono -->
            <div class="col-md-6">
                <div class="form-floating">
                    <input type="tel" class="form-control" id="telefono" name="telefono" placeholder="Telefono">
                    <label for="telefono"><i class="fas fa-phone me-2"></i>Telefono</label>
                </div>
            </div>

            <!-- Azienda -->
            <div class="col-md-6">
                <div class="form-floating">
                    <input type="text" class="form-control" id="azienda" name="azienda" placeholder="Azienda">
                    <label for="azienda"><i class="fas fa-building me-2"></i>Azienda</label>
                </div>
            </div>

            <!-- Localit√† -->
            <div class="col-md-8">
                <div class="form-floating">
                    <input type="text" class="form-control" id="comune" name="comune" placeholder="Citt√† o Comune">
                    <label for="comune"><i class="fas fa-map-marker-alt me-2"></i>Citt√† o Comune</label>
                </div>
            </div>

            <!-- Numero Dipendenti -->
            <div class="col-md-4">
                <div class="form-floating">
                    <select class="form-select" id="dipendenti" name="dipendenti">
                        <option value="">Seleziona</option>
                        <option value="1-5">1-5</option>
                        <option value="6-15">6-15</option>
                        <option value="16-50">16-50</option>
                        <option value="50+">50+</option>
                    </select>
                    <label for="dipendenti"><i class="fas fa-users me-2"></i>Dipendenti</label>
                </div>
            </div>

            <!-- Servizio Richiesto -->
            <div class="col-12">
                <div class="form-floating">
                    <select class="form-select" id="servizio" name="servizio" required>
                        <option value="">Seleziona il servizio</option>
                        <option value="Assistenza IT">Assistenza IT Generale</option>
                        <option value="Sicurezza Informatica">Sicurezza Informatica</option>
                        <option value="Cloud Storage">Cloud Storage e Backup</option>
                        <option value="Firewall e Protezione">Firewall e Protezione Rete</option>
                        <option value="VoIP e Telefonia">VoIP e Telefonia</option>
                        <option value="Backup Automatico">Backup Automatico</option>
                        <option value="Consulenza IT">Consulenza IT Strategica</option>
                        <option value="Migrazione Cloud">Migrazione al Cloud</option>
                        <option value="Supporto Office 365">Supporto Microsoft 365</option>
                        <option value="Altro">Altro servizio</option>
                    </select>
                    <label for="servizio"><i class="fas fa-cogs me-2"></i>Servizio Richiesto *</label>
                </div>
            </div>

            <!-- Urgenza -->
            <div class="col-12">
                <div class="form-floating">
                    <select class="form-select" id="urgenza" name="urgenza">
                        <option value="normale">Normale (risposta in 4h)</option>
                        <option value="urgente">Urgente (risposta in 15min)</option>
                    </select>
                    <label for="urgenza"><i class="fas fa-exclamation-circle me-2"></i>Priorit√†</label>
                </div>
            </div>

            <!-- Messaggio -->
            <div class="col-12">
                <div class="form-floating">
                    <textarea class="form-control" id="messaggio" name="messaggio" style="height: 120px;" placeholder="Descrivi la tua richiesta..." required></textarea>
                    <label for="messaggio"><i class="fas fa-comment me-2"></i>Descrivi la tua richiesta *</label>
                </div>
            </div>

            <!-- Privacy Checkbox -->
            <div class="col-12">
                <div class="privacy-check">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="privacy" name="privacy" required>
                        <label class="form-check-label" for="privacy">
                            <strong>Privacy e Consenso *</strong><br>
                            <small class="text-muted">
                                Ho letto e accetto l'<a href="/privacy-policy.html" target="_blank">Informativa Privacy</a> e autorizzo il trattamento dei miei dati personali per finalit√† commerciali e di marketing da parte di IT-ERA.
                            </small>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Optional: Send Copy -->
            <div class="col-12">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="sendCopy" name="sendCopy">
                    <label class="form-check-label" for="sendCopy">
                        <small>Invia una copia della richiesta al mio indirizzo email</small>
                    </label>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="col-12 text-center">
                <button type="submit" class="btn btn-contact-submit btn-lg">
                    <span class="btn-text">
                        <i class="fas fa-paper-plane me-2"></i>Invia Richiesta Gratuita
                    </span>
                </button>
            </div>
        </div>

        <!-- Form Feedback Area -->
        <div class="form-feedback" id="formFeedback"></div>
    </form>

    <!-- Trust Signals -->
    <div class="text-center mt-4">
        <small class="text-muted">
            <i class="fas fa-lock me-1"></i>
            I tuoi dati sono protetti e non verranno mai condivisi con terze parti
        </small>
    </div>
</div>

<script>
// Enhanced Contact Form Handler with Resend Integration
class UniversalContactFormHandler {
    constructor() {
        // Update API endpoint to use new Resend worker
        this.apiEndpoint = 'https://it-era-resend.bulltech.workers.dev/api/contact';
        this.isSubmitting = false;
        this.init();
    }

    init() {
        const form = document.getElementById('universalContactForm');
        if (form) {
            this.setupForm(form);
            this.setupCityDetection();
            this.setupAnalytics();
        }
    }

    setupForm(form) {
        // Form submit handler
        form.addEventListener('submit', (e) => this.handleSubmit(e, form));
        
        // Real-time validation
        const inputs = form.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            input.addEventListener('blur', () => this.validateField(input));
            input.addEventListener('input', () => this.clearError(input));
        });

        // Service auto-detection from page
        this.detectService(form);
        
        // Dynamic urgency handling
        this.setupUrgencyHandler(form);
    }

    setupCityDetection() {
        // Auto-detect city from page URL or title
        const pageTitle = document.title;
        const urlPath = window.location.pathname;
        
        // Extract city from URL or title
        const cityMatch = pageTitle.match(/Assistenza IT (.+?) \|/) || 
                         urlPath.match(/assistenza-it-(.+?)\.html/) ||
                         urlPath.match(/cloud-storage-(.+?)\.html/) ||
                         urlPath.match(/sicurezza-informatica-(.+?)\.html/);
        
        if (cityMatch && cityMatch[1]) {
            const cityField = document.getElementById('comune');
            if (cityField && !cityField.value) {
                // Convert slug to proper city name
                const cityName = cityMatch[1]
                    .replace(/-/g, ' ')
                    .replace(/\b\w/g, l => l.toUpperCase());
                cityField.value = cityName;
            }
        }
    }

    detectService(form) {
        const serviceField = document.getElementById('servizio');
        const pageUrl = window.location.pathname;
        const pageTitle = document.title.toLowerCase();
        
        let detectedService = '';
        
        if (pageUrl.includes('sicurezza-informatica') || pageTitle.includes('sicurezza')) {
            detectedService = 'Sicurezza Informatica';
        } else if (pageUrl.includes('cloud-storage') || pageTitle.includes('cloud')) {
            detectedService = 'Cloud Storage';
        } else if (pageUrl.includes('backup') || pageTitle.includes('backup')) {
            detectedService = 'Backup Automatico';
        } else if (pageUrl.includes('firewall') || pageTitle.includes('firewall')) {
            detectedService = 'Firewall e Protezione';
        } else if (pageUrl.includes('voip') || pageTitle.includes('telefonia')) {
            detectedService = 'VoIP e Telefonia';
        } else {
            detectedService = 'Assistenza IT';
        }
        
        if (serviceField && detectedService) {
            serviceField.value = detectedService;
        }
    }

    setupUrgencyHandler(form) {
        const urgencyField = document.getElementById('urgenza');
        urgencyField.addEventListener('change', (e) => {
            const isUrgent = e.target.value === 'urgente';
            const submitBtn = form.querySelector('.btn-contact-submit .btn-text');
            
            if (isUrgent) {
                submitBtn.innerHTML = '<i class="fas fa-bolt me-2"></i>Richiesta Urgente - Risposta in 15min';
                form.classList.add('urgent-form');
            } else {
                submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>Invia Richiesta Gratuita';
                form.classList.remove('urgent-form');
            }
        });
    }

    setupAnalytics() {
        // Track form interactions
        const form = document.getElementById('universalContactForm');
        const inputs = form.querySelectorAll('input, textarea, select');
        
        inputs.forEach(input => {
            input.addEventListener('focus', () => {
                this.trackEvent('form_field_focus', {
                    field: input.name,
                    form_type: 'contact_form'
                });
            });
        });

        // Track scroll to form
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    this.trackEvent('form_view', {
                        form_type: 'contact_form',
                        page: window.location.pathname
                    });
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });
        
        observer.observe(form);
    }

    validateField(field) {
        const value = field.value.trim();
        const type = field.type;
        const name = field.name;
        let isValid = true;
        let errorMessage = '';

        // Required field validation
        if (field.hasAttribute('required') && !value) {
            errorMessage = 'Questo campo √® obbligatorio';
            isValid = false;
        }
        // Email validation
        else if (type === 'email' || name === 'email') {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (value && !emailRegex.test(value)) {
                errorMessage = 'Inserisci un\'email valida';
                isValid = false;
            }
        }
        // Phone validation (Italian format)
        else if (type === 'tel' || name === 'telefono') {
            const phoneRegex = /^(\+39)?[\s\-\.]?[0-9]{3,4}[\s\-\.]?[0-9]{6,7}$/;
            if (value && !phoneRegex.test(value.replace(/\s/g, ''))) {
                errorMessage = 'Inserisci un numero valido (es: 039 888 2041)';
                isValid = false;
            }
        }
        // Name validation
        else if (name === 'nome') {
            if (value && value.length < 2) {
                errorMessage = 'Il nome deve avere almeno 2 caratteri';
                isValid = false;
            }
        }
        // Message validation
        else if (name === 'messaggio') {
            if (value && value.length < 10) {
                errorMessage = 'Il messaggio deve avere almeno 10 caratteri';
                isValid = false;
            }
        }

        if (!isValid) {
            this.showFieldError(field, errorMessage);
        } else {
            this.clearError(field);
        }

        return isValid;
    }

    showFieldError(field, message) {
        this.clearError(field);
        
        field.classList.add('is-invalid');
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'invalid-feedback';
        errorDiv.textContent = message;
        
        field.parentNode.insertBefore(errorDiv, field.nextSibling);
    }

    clearError(field) {
        field.classList.remove('is-invalid');
        const errorDiv = field.parentNode.querySelector('.invalid-feedback');
        if (errorDiv) {
            errorDiv.remove();
        }
    }

    async handleSubmit(e, form) {
        e.preventDefault();

        if (this.isSubmitting) return;

        // Validate all fields
        const inputs = form.querySelectorAll('input[required], textarea[required], select[required]');
        let isValid = true;
        inputs.forEach(input => {
            if (!this.validateField(input)) {
                isValid = false;
            }
        });

        // Validate privacy checkbox
        const privacyCheck = form.querySelector('#privacy');
        if (!privacyCheck.checked) {
            this.showFeedback(form, 'Devi accettare l\'informativa privacy per continuare', 'danger');
            privacyCheck.focus();
            return;
        }

        if (!isValid) {
            this.showFeedback(form, 'Correggi gli errori evidenziati nel modulo', 'danger');
            return;
        }

        this.isSubmitting = true;
        this.showLoading(form, true);

        try {
            // Collect form data
            const formData = new FormData(form);
            const data = {
                nome: formData.get('nome'),
                email: formData.get('email'),
                telefono: formData.get('telefono') || '',
                azienda: formData.get('azienda') || '',
                comune: formData.get('comune') || '',
                servizio: formData.get('servizio'),
                messaggio: formData.get('messaggio'),
                urgenza: formData.get('urgenza') || 'normale',
                dipendenti: formData.get('dipendenti') || '',
                privacy: formData.get('privacy') === 'on',
                sendCopy: formData.get('sendCopy') === 'on'
            };

            // Track form submission attempt
            this.trackEvent('form_submit_attempt', {
                servizio: data.servizio,
                urgenza: data.urgenza,
                comune: data.comune
            });

            // Send to API
            const response = await fetch(this.apiEndpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok && result.success) {
                // Success
                this.showSuccessMessage(form, result);
                form.reset();
                
                // Track successful submission
                this.trackEvent('form_submit_success', {
                    ticketId: result.ticketId,
                    servizio: data.servizio,
                    urgenza: data.urgenza
                });

                // Scroll to success message
                form.scrollIntoView({ behavior: 'smooth' });
                
            } else {
                // Error
                const errorMessage = result.errors ? result.errors.join(', ') : 
                                   result.error || 'Errore durante l\'invio. Riprova.';
                this.showFeedback(form, errorMessage, 'danger');
                
                // Track failed submission
                this.trackEvent('form_submit_error', {
                    error: errorMessage,
                    servizio: data.servizio
                });
            }
        } catch (error) {
            console.error('Form submission error:', error);
            this.showFeedback(form, 
                'Errore di connessione. Verifica la connessione e riprova o chiamaci al 039 888 2041.', 
                'danger'
            );
            
            // Track network error
            this.trackEvent('form_submit_network_error', {
                error: error.message
            });
        } finally {
            this.isSubmitting = false;
            this.showLoading(form, false);
        }
    }

    showSuccessMessage(form, result) {
        const urgencyMessage = result.message;
        const ticketId = result.ticketId;
        const nextSteps = result.nextSteps || [];
        const estimatedResponse = result.estimatedResponse || '4 ore';

        const successHtml = `
            <div class="text-center">
                <div class="feedback-icon">‚úÖ</div>
                <h4 class="text-success mb-3">Richiesta Inviata con Successo!</h4>
                <p class="mb-3">${urgencyMessage}</p>
                
                <div class="alert alert-info mb-3">
                    <strong>üìã Ticket ID:</strong> ${ticketId}<br>
                    <small>Conserva questo codice per riferimenti futuri</small>
                </div>
                
                ${nextSteps.length ? `
                <div class="text-start">
                    <h6>üöÄ Prossimi Passi:</h6>
                    <ul class="list-unstyled">
                        ${nextSteps.map(step => `<li class="mb-2">‚Ä¢ ${step}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
                
                <div class="mt-4">
                    <a href="tel:+390398882041" class="btn btn-outline-primary me-2">
                        üìû 039 888 2041
                    </a>
                    <a href="mailto:info@it-era.it" class="btn btn-outline-secondary">
                        ‚úâÔ∏è info@it-era.it
                    </a>
                </div>
            </div>
        `;
        
        this.showFeedback(form, successHtml, 'success', false);
    }

    showLoading(form, show) {
        const submitBtn = form.querySelector('.btn-contact-submit');
        const btnText = submitBtn.querySelector('.btn-text');
        
        if (show) {
            submitBtn.disabled = true;
            btnText.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Invio in corso...';
        } else {
            submitBtn.disabled = false;
            const isUrgent = form.querySelector('#urgenza').value === 'urgente';
            btnText.innerHTML = isUrgent 
                ? '<i class="fas fa-bolt me-2"></i>Richiesta Urgente - Risposta in 15min'
                : '<i class="fas fa-paper-plane me-2"></i>Invia Richiesta Gratuita';
        }
    }

    showFeedback(form, message, type, isText = true) {
        const feedbackDiv = form.querySelector('#formFeedback');
        if (!feedbackDiv) return;

        const classes = {
            success: 'alert alert-success',
            danger: 'alert alert-danger',
            warning: 'alert alert-warning',
            info: 'alert alert-info'
        };

        feedbackDiv.className = `form-feedback ${classes[type] || classes.info}`;
        
        if (isText) {
            const icon = type === 'success' ? '‚úÖ' : type === 'danger' ? '‚ùå' : '‚ÑπÔ∏è';
            feedbackDiv.innerHTML = `
                <div class="d-flex align-items-start">
                    <span class="feedback-icon me-2">${icon}</span>
                    <span>${message}</span>
                </div>
            `;
        } else {
            feedbackDiv.innerHTML = message;
        }
        
        // Scroll to feedback
        feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

        // Auto-hide success messages after 15 seconds
        if (type === 'success') {
            setTimeout(() => {
                feedbackDiv.style.opacity = '0';
                setTimeout(() => {
                    feedbackDiv.innerHTML = '';
                    feedbackDiv.style.opacity = '1';
                }, 300);
            }, 15000);
        }
    }

    trackEvent(eventName, parameters = {}) {
        // Google Analytics 4
        if (typeof gtag !== 'undefined') {
            gtag('event', eventName, {
                event_category: 'Contact Form',
                event_label: parameters.servizio || 'Unknown',
                ...parameters
            });
        }

        // Google Tag Manager
        if (typeof dataLayer !== 'undefined') {
            dataLayer.push({
                event: eventName,
                form_type: 'contact',
                ...parameters
            });
        }

        // Console log for debugging
        console.log('Event tracked:', eventName, parameters);
    }
}

// Utility function for emergency click tracking
function trackEmergencyClick() {
    if (typeof gtag !== 'undefined') {
        gtag('event', 'emergency_call', {
            event_category: 'Contact',
            event_label: 'Emergency Phone Click'
        });
    }
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        new UniversalContactFormHandler();
    });
} else {
    new UniversalContactFormHandler();
}
</script>