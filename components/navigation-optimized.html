<!-- Optimized Navigation with Conversion Focus - DEVI Enhanced -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm" data-navigation-source="canonical" data-devi-version="1.0">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">
            <span style="color: #0056cc;">IT</span>-ERA
        </a>
        
        <!-- Emergency CTA for Mobile -->
        <div class="d-lg-none ms-auto me-2">
            <a href="tel:+390398882041" class="btn btn-danger btn-sm">
                üö® Emergenza
            </a>
        </div>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-lg-center">
                <!-- Emergency Support - Primary CTA -->
                <li class="nav-item d-none d-lg-block">
                    <a class="nav-link text-danger fw-bold" href="tel:+390398882041">
                        üö® Supporto Urgente
                    </a>
                </li>
                
                <!-- Services Dropdown with Icons -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Servizi
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header text-muted small">ASSISTENZA IMMEDIATA</li>
                        <li><a class="dropdown-item" href="/assistenza-it-milano.html">
                            üîß Assistenza IT <span class="badge bg-danger ms-2">15min</span>
                        </a></li>
                        <li><a class="dropdown-item" href="/sicurezza-informatica-milano.html">
                            üõ°Ô∏è Sicurezza Informatica
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-header text-muted small">SOLUZIONI CLOUD</li>
                        <li><a class="dropdown-item" href="/cloud-storage-milano.html">
                            ‚òÅÔ∏è Cloud Storage
                        </a></li>
                        <li><a class="dropdown-item" href="/backup-disaster-recovery-milano.html">
                            üíæ Backup Automatico
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-header text-muted small">SETTORI SPECIALIZZATI</li>
                        <li><a class="dropdown-item" href="/it-studi-medici-lombardia.html">
                            ‚öïÔ∏è IT Studi Medici
                        </a></li>
                        <li><a class="dropdown-item" href="/it-studi-legali-lombardia.html">
                            ‚öñÔ∏è IT Studi Legali
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-header text-muted small">PACCHETTI SPECIALI</li>
                        <li><a class="dropdown-item" href="/all-inclusive-pmi.html">
                            ‚≠ê All-Inclusive PMI <span class="badge bg-success ms-2">-30%</span>
                        </a></li>
                    </ul>
                </li>
                
                <!-- Industry Sectors Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Settori
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/settori-pmi-startup.html">
                            üè¢ PMI e Startup
                        </a></li>
                        <li><a class="dropdown-item" href="/settori-studi-medici.html">
                            ‚öïÔ∏è Studi Medici
                        </a></li>
                        <li><a class="dropdown-item" href="/settori-commercialisti.html">
                            üìä Commercialisti
                        </a></li>
                        <li><a class="dropdown-item" href="/settori-studi-legali.html">
                            ‚öñÔ∏è Studi Legali
                        </a></li>
                        <li><a class="dropdown-item" href="/settori-industria.html">
                            üè≠ Industria 4.0
                        </a></li>
                        <li><a class="dropdown-item" href="/settori-retail.html">
                            üõçÔ∏è Retail e GDO
                        </a></li>
                    </ul>
                </li>
                
                <!-- Coverage Areas -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="/servizi" role="button" data-bs-toggle="dropdown">
                        Zone Coperte
                    </a>
                    <ul class="dropdown-menu dropdown-menu-columns">
                        <div class="row g-0">
                            <div class="col-6">
                                <li class="dropdown-header text-muted small">MILANO E BRIANZA</li>
                                <li><a class="dropdown-item small" href="/assistenza-it-milano.html">Milano</a></li>
                                <li><a class="dropdown-item small" href="/assistenza-it-monza.html">Monza</a></li>
                                <li><a class="dropdown-item small" href="/pages/assistenza-it-vimercate.html">Vimercate</a></li>
                                <li><a class="dropdown-item small" href="/pages/assistenza-it-seregno.html">Seregno</a></li>
                                <li><a class="dropdown-item small" href="/pages/assistenza-it-lissone.html">Lissone</a></li>
                            </div>
                            <div class="col-6">
                                <li class="dropdown-header text-muted small">COMO E LECCO</li>
                                <li><a class="dropdown-item small" href="/assistenza-it-como.html">Como</a></li>
                                <li><a class="dropdown-item small" href="/assistenza-it-lecco.html">Lecco</a></li>
                                <li><a class="dropdown-item small" href="/pages/assistenza-it-cantu.html">Cant√π</a></li>
                                <li><a class="dropdown-item small" href="/pages/assistenza-it-merate.html">Merate</a></li>
                                <li><a class="dropdown-item small" href="/servizi.html" class="text-primary">Vedi tutte ‚Üí</a></li>
                            </div>
                        </div>
                    </ul>
                </li>
                
                <!-- Why IT-ERA -->
                <li class="nav-item">
                    <a class="nav-link" href="/perche-it-era.html">Perch√© IT-ERA</a>
                </li>

                <!-- Blog -->
                <li class="nav-item">
                    <a class="nav-link" href="/blog/">
                        üìù Blog
                    </a>
                </li>

                <!-- Contact -->
                <li class="nav-item">
                    <a class="nav-link" href="/contatti.html">Contatti</a>
                </li>
                
                <!-- Primary CTA Button -->
                <li class="nav-item ms-lg-3">
                    <a href="tel:+390398882041" class="btn btn-primary">
                        üìû 039 888 2041
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Bootstrap JavaScript for dropdown functionality -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JavaScript for enhanced dropdown behavior -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ IT-ERA Dropdown Fix Initialized');
    
    // Force Bootstrap dropdown initialization
    const dropdownTriggers = document.querySelectorAll('[data-bs-toggle="dropdown"]');
    console.log('üîç Found dropdown triggers:', dropdownTriggers.length);
    
    dropdownTriggers.forEach((trigger, index) => {
        console.log(`üéØ Initializing dropdown ${index + 1}:`, trigger.textContent.trim());
        
        // Force Bootstrap dropdown instance creation
        try {
            const dropdown = new bootstrap.Dropdown(trigger);
            console.log(`‚úÖ Bootstrap dropdown ${index + 1} initialized successfully`);
            
            // Add manual click handler as fallback
            trigger.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const dropdownMenu = trigger.nextElementSibling;
                if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
                    // Toggle visibility
                    if (dropdownMenu.classList.contains('show')) {
                        dropdownMenu.classList.remove('show');
                        trigger.setAttribute('aria-expanded', 'false');
                    } else {
                        // Close other dropdowns first
                        document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                            menu.classList.remove('show');
                            menu.previousElementSibling.setAttribute('aria-expanded', 'false');
                        });
                        
                        // Open this dropdown
                        dropdownMenu.classList.add('show');
                        trigger.setAttribute('aria-expanded', 'true');
                    }
                }
            });
            
        } catch (error) {
            console.error(`‚ùå Error initializing dropdown ${index + 1}:`, error);
            
            // Fallback: Manual dropdown functionality
            trigger.addEventListener('click', function(e) {
                e.preventDefault();
                const dropdownMenu = trigger.nextElementSibling;
                if (dropdownMenu) {
                    dropdownMenu.classList.toggle('show');
                    trigger.setAttribute('aria-expanded', 
                        dropdownMenu.classList.contains('show') ? 'true' : 'false');
                }
            });
        }
    });
    
    // Enhanced dropdown behavior for desktop hover
    const dropdowns = document.querySelectorAll('.dropdown');
    
    dropdowns.forEach(dropdown => {
        const toggle = dropdown.querySelector('.dropdown-toggle');
        const menu = dropdown.querySelector('.dropdown-menu');
        
        // Ensure dropdown works on both click and hover on desktop
        if (window.innerWidth >= 992) {
            dropdown.addEventListener('mouseenter', function() {
                menu?.classList.add('show');
                toggle?.setAttribute('aria-expanded', 'true');
            });
            
            dropdown.addEventListener('mouseleave', function() {
                menu?.classList.remove('show');
                toggle?.setAttribute('aria-expanded', 'false');
            });
        }
        
        // Prevent dropdown from closing when clicking inside
        menu?.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.dropdown')) {
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                menu.classList.remove('show');
                menu.previousElementSibling?.setAttribute('aria-expanded', 'false');
            });
        }
    });
    
    // Track phone clicks for analytics
    const phoneLinks = document.querySelectorAll('a[href^="tel:"]');
    phoneLinks.forEach(link => {
        link.addEventListener('click', function() {
            if (typeof gtag !== 'undefined') {
                gtag('event', 'click', {
                    'event_category': 'engagement',
                    'event_label': 'phone_call'
                });
            }
        });
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    console.log('üéâ IT-ERA Navigation Enhancement Complete');
});
</script>

<!-- CSS ENHANCEMENT for dropdown visibility and functionality -->
<style>
/* DROPDOWN FIX: Enhanced CSS for better dropdown functionality */
.dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    min-width: 10rem;
    padding: 0.5rem 0;
    margin: 0;
    background-color: #fff;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 0.375rem;
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,.175);
}

.dropdown-menu.show {
    display: block !important;
}

.dropdown-toggle:after {
    display: inline-block;
    margin-left: 0.255em;
    vertical-align: 0.255em;
    content: "";
    border-top: 0.3em solid;
    border-right: 0.3em solid transparent;
    border-bottom: 0;
    border-left: 0.3em solid transparent;
}

.dropdown:hover .dropdown-menu {
    display: block;
}

/* Custom styles for optimized navigation */
.navbar {
    min-height: 76px;
}

.dropdown-menu-columns {
    min-width: 400px;
}

.dropdown-header {
    font-weight: 600;
    padding: 0.5rem 1rem 0.25rem;
}

.dropdown-item {
    padding: 0.4rem 1rem;
    transition: all 0.2s ease;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
    padding-left: 1.25rem;
}

.badge {
    font-size: 0.7rem;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* Mobile dropdown enhancements */
@media (max-width: 991px) {
    .dropdown-menu {
        position: static;
        display: none;
        width: 100%;
        border: none;
        box-shadow: none;
        background-color: #f8f9fa;
    }
    
    .dropdown-menu.show {
        display: block !important;
    }
    
    .dropdown:hover .dropdown-menu {
        display: none; /* Disable hover on mobile */
    }
    
    .dropdown-menu-columns {
        min-width: 100%;
    }
    
    .dropdown-menu-columns .row {
        display: block;
    }
    
    .navbar-nav {
        padding: 1rem 0;
    }
    
    .nav-item {
        border-bottom: 1px solid #f8f9fa;
    }
    
    .nav-item:last-child {
        border-bottom: none;
        margin-top: 1rem;
    }
}
</style>